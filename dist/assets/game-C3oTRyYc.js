import{s as K,r as x,c as G}from"./index-B-TiXjD_.js";var a=(_=>(_.EAST="east",_.SOUTH="south",_.WEST="west",_.NORTH="north",_))(a||{}),v=(_=>(_.SELF_DRAW="self_draw",_.DISCARD="discard",_.DRAW="draw",_))(v||{}),e=(_=>(_.BUTT_HU="butt_hu",_.COMMON="common",_.CONCEALED_HAND="concealed_hand",_.ALL_PUNGS="all_pungs",_.MIXED_ONE_SUIT="mixed_one_suit",_.ALL_HUMAN="all_human",_.THREE_CONCEALED_PUNGS="three_concealed_pungs",_.FOUR_CONCEALED_PUNGS="four_concealed_pungs",_.FIVE_CONCEALED_PUNGS="five_concealed_pungs",_.WAITING_ONE="waiting_one",_.EDGE_WAIT="edge_wait",_.MIDDLE_WAIT="middle_wait",_.MIGI="migi",_.KONG_ON_KONG="kong_on_kong",_.ROBBING_KONG="robbing_kong",_.RED_DRAGON="red_dragon",_.GREEN_DRAGON="green_dragon",_.WHITE_DRAGON="white_dragon",_.SMALL_THREE_DRAGONS="small_three_dragons",_.BIG_THREE_DRAGONS="big_three_dragons",_.EAST_WIND="east_wind",_.SOUTH_WIND="south_wind",_.WEST_WIND="west_wind",_.NORTH_WIND="north_wind",_.SMALL_FOUR_WINDS="small_four_winds",_.BIG_FOUR_WINDS="big_four_winds",_.CORRECT_FLOWER="correct_flower",_.ALL_FLOWERS="all_flowers",_.LAST_TILE_DRAW="last_tile_draw",_.BLESSING_OF_HEAVEN="blessing_of_heaven",_.BLESSING_OF_EARTH="blessing_of_earth",_.ALL_HONORS="all_honors",_.ALL_ONE_SUIT="all_one_suit",_.LIU_LIU="liu_liu",_))(e||{});const J={[a.EAST]:"東",[a.SOUTH]:"南",[a.WEST]:"西",[a.NORTH]:"北"},q={[e.BUTT_HU]:"屁胡",[e.COMMON]:"平胡",[e.CONCEALED_HAND]:"門清",[e.ALL_PUNGS]:"碰碰胡",[e.MIXED_ONE_SUIT]:"混一色",[e.ALL_ONE_SUIT]:"清一色",[e.LIU_LIU]:"嚦咕嚦咕",[e.KONG_ON_KONG]:"槓上開花",[e.ROBBING_KONG]:"搶槓",[e.RED_DRAGON]:"紅中",[e.GREEN_DRAGON]:"青發",[e.WHITE_DRAGON]:"白板",[e.SMALL_THREE_DRAGONS]:"小三元",[e.BIG_THREE_DRAGONS]:"大三元",[e.EAST_WIND]:"東風",[e.SOUTH_WIND]:"南風",[e.WEST_WIND]:"西風",[e.NORTH_WIND]:"北風",[e.SMALL_FOUR_WINDS]:"小四喜",[e.BIG_FOUR_WINDS]:"大四喜",[e.CORRECT_FLOWER]:"正花",[e.ALL_FLOWERS]:"八仙過海",[e.LAST_TILE_DRAW]:"海底撈月",[e.BLESSING_OF_HEAVEN]:"天胡",[e.BLESSING_OF_EARTH]:"地胡",[e.ALL_HONORS]:"字一色",[e.ALL_HUMAN]:"全求人",[e.THREE_CONCEALED_PUNGS]:"三暗刻",[e.FOUR_CONCEALED_PUNGS]:"四暗刻",[e.FIVE_CONCEALED_PUNGS]:"五暗刻",[e.WAITING_ONE]:"單吊",[e.EDGE_WAIT]:"邊張",[e.MIDDLE_WAIT]:"中洞",[e.MIGI]:"migi"},z={tai0:[e.BUTT_HU],tai1:[e.CONCEALED_HAND,e.WAITING_ONE,e.EDGE_WAIT,e.MIDDLE_WAIT,e.KONG_ON_KONG,e.ROBBING_KONG,e.RED_DRAGON,e.GREEN_DRAGON,e.WHITE_DRAGON,e.EAST_WIND,e.SOUTH_WIND,e.WEST_WIND,e.NORTH_WIND,e.CORRECT_FLOWER,e.LAST_TILE_DRAW],tai2:[e.COMMON,e.ALL_PUNGS,e.ALL_HUMAN,e.THREE_CONCEALED_PUNGS],tai4:[e.MIXED_ONE_SUIT,e.FOUR_CONCEALED_PUNGS,e.SMALL_THREE_DRAGONS],tai8:[e.FIVE_CONCEALED_PUNGS,e.BIG_THREE_DRAGONS,e.SMALL_FOUR_WINDS,e.ALL_FLOWERS,e.ALL_ONE_SUIT,e.LIU_LIU,e.MIGI],tai16:[e.BIG_FOUR_WINDS,e.BLESSING_OF_EARTH,e.ALL_HONORS],tai24:[e.BLESSING_OF_HEAVEN]},V=[a.EAST,a.SOUTH,a.WEST,a.NORTH],C=[a.EAST,a.SOUTH,a.WEST,a.NORTH],i={basePoint:10,baseMultiplier:2,startingScore:0,enableContinuousDealer:!1,enableFlowerTiles:!1,enableHonorTiles:!1,enableLiuLiu:!1},Q={[e.BUTT_HU]:0,[e.COMMON]:2,[e.CONCEALED_HAND]:1,[e.ALL_PUNGS]:2,[e.MIXED_ONE_SUIT]:4,[e.ALL_HUMAN]:2,[e.THREE_CONCEALED_PUNGS]:2,[e.FOUR_CONCEALED_PUNGS]:4,[e.FIVE_CONCEALED_PUNGS]:8,[e.WAITING_ONE]:1,[e.EDGE_WAIT]:1,[e.MIDDLE_WAIT]:1,[e.MIGI]:8,[e.KONG_ON_KONG]:1,[e.ROBBING_KONG]:1,[e.RED_DRAGON]:1,[e.GREEN_DRAGON]:1,[e.WHITE_DRAGON]:1,[e.SMALL_THREE_DRAGONS]:4,[e.BIG_THREE_DRAGONS]:8,[e.EAST_WIND]:1,[e.SOUTH_WIND]:1,[e.WEST_WIND]:1,[e.NORTH_WIND]:1,[e.SMALL_FOUR_WINDS]:8,[e.BIG_FOUR_WINDS]:16,[e.CORRECT_FLOWER]:1,[e.ALL_FLOWERS]:8,[e.LAST_TILE_DRAW]:1,[e.BLESSING_OF_HEAVEN]:24,[e.BLESSING_OF_EARTH]:16,[e.ALL_HONORS]:16,[e.ALL_ONE_SUIT]:8,[e.LIU_LIU]:8},M={CURRENT_GAME:"mahjong_current_game"};function j(_,l,n,T,f,W){const O=(W+T)*f,N=[];return l===v.SELF_DRAW?Object.values(a).forEach(o=>{o===_?N.push({position:o,change:O*3}):N.push({position:o,change:-O})}):l===v.DISCARD&&n&&Object.values(a).forEach(o=>{o===_?N.push({position:o,change:O}):o===n?N.push({position:o,change:-O}):N.push({position:o,change:0})}),N}function b(_,l){return _+l}function X(_,l){try{const n=JSON.stringify(l);localStorage.setItem(_,n)}catch(n){console.error("儲存資料失敗:",n)}}function Y(_){try{const l=localStorage.getItem(_);return l?JSON.parse(l):null}catch(l){return console.error("讀取資料失敗:",l),null}}function $(_){try{localStorage.removeItem(_)}catch(l){console.error("刪除資料失敗:",l)}}const Z=K("game",()=>{const _=x(null),l=G(()=>{var t;return((t=_.value)==null?void 0:t.isActive)??!1}),n=G(()=>{var t;return((t=_.value)==null?void 0:t.players)??[]}),T=G(()=>{var t;return((t=_.value)==null?void 0:t.rounds)??[]}),f=G(()=>{var t;return((t=_.value)==null?void 0:t.settings)??i});function W(t,r){const s=Date.now(),E=`game_${s}`,c=V.map((u,D)=>({id:`player_${D}`,name:t[D]||`玩家${D+1}`,position:u,totalScore:(r==null?void 0:r.startingScore)??i.startingScore}));_.value={gameId:E,startTime:s,players:c,rounds:[],settings:{...i,...r},currentRoundNumber:1,currentDealer:a.EAST,dealerWinCount:0,isActive:!0},L()}function O(t,r,s,E,c){if(!_.value){console.error("遊戲狀態不存在，無法新增記錄");return}const{settings:u,currentRoundNumber:D}=_.value;console.log("新增記錄：",{winnerPosition:t,winType:r,tai:s,loserPosition:E,basePoint:u.basePoint,baseMultiplier:u.baseMultiplier});const d=r==="draw",S=_.value.currentDealer;let I=[],A=!1,R=S;d?(I=[],A=!0,R=S,_.value.dealerWinCount+=1):(I=j(t,r,E,s,u.basePoint,u.baseMultiplier),console.log("計算的分數變動：",I),I.forEach(({position:B,change:P})=>{const g=_.value.players.find(w=>w.position===B);g&&(g.totalScore=b(g.totalScore,P))}),A=t===S,A&&(_.value.dealerWinCount+=1),R=A?S:N(S));const H={id:`round_${Date.now()}`,roundNumber:D,timestamp:Date.now(),dealerPosition:S,nextDealer:R,isDealerWin:A,dealerWinCount:_.value.dealerWinCount,winnerPosition:t,winType:r,loserPosition:E,handType:c,tai:s,basePoint:u.basePoint,baseMultiplier:u.baseMultiplier,scoreChanges:I};_.value.rounds.push(H),_.value.currentRoundNumber+=1,_.value.currentDealer=R,A||(_.value.dealerWinCount=0),L()}function N(t){const s=(C.indexOf(t)+1)%C.length;return C[s]}function U(t){if(!_.value)return;const r=_.value.rounds.findIndex(s=>s.id===t);r!==-1&&(_.value.rounds.splice(r),o(),L())}function o(){_.value&&(_.value.players.forEach(t=>{t.totalScore=_.value.settings.startingScore}),_.value.rounds.forEach(t=>{t.scoreChanges.forEach(({position:r,change:s})=>{const E=_.value.players.find(c=>c.position===r);E&&(E.totalScore=b(E.totalScore,s))})}))}function h(){_.value&&(_.value.isActive=!1,L())}function L(){_.value&&X(M.CURRENT_GAME,_.value)}function m(){const t=Y(M.CURRENT_GAME);t&&(!t.settings.baseMultiplier&&t.settings.baseMultiplier!==0&&(t.settings.baseMultiplier=i.baseMultiplier),t.settings.enableFlowerTiles===void 0&&(t.settings.enableFlowerTiles=i.enableFlowerTiles),t.settings.enableHonorTiles===void 0&&(t.settings.enableHonorTiles=i.enableHonorTiles),t.settings.enableLiuLiu===void 0&&(t.settings.enableLiuLiu=i.enableLiuLiu),t.currentDealer||(t.currentDealer=a.EAST),t.dealerWinCount===void 0&&(t.dealerWinCount=0),t.rounds.forEach(r=>{!r.baseMultiplier&&r.baseMultiplier!==0&&(r.baseMultiplier=t.settings.baseMultiplier)}),_.value=t)}function F(){_.value=null,$(M.CURRENT_GAME)}return{gameState:_,isGameActive:l,currentPlayers:n,currentRounds:T,currentSettings:f,startNewGame:W,addRound:O,deleteRound:U,endGame:h,loadGameState:m,clearGameState:F,recalculateAllScores:o}});export{z as C,i as D,Q as H,V as W,J as a,a as b,v as c,j as d,q as e,e as f,Z as u};
