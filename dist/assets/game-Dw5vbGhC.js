import{s as K,r as x,c as C}from"./index-DHn3yG1W.js";var l=(_=>(_.EAST="east",_.SOUTH="south",_.WEST="west",_.NORTH="north",_))(l||{}),b=(_=>(_.SELF_DRAW="self_draw",_.DISCARD="discard",_.DRAW="draw",_))(b||{}),e=(_=>(_.BUTT_HU="butt_hu",_.COMMON="common",_.CONCEALED_HAND="concealed_hand",_.ALL_PUNGS="all_pungs",_.MIXED_ONE_SUIT="mixed_one_suit",_.ALL_HUMAN="all_human",_.THREE_CONCEALED_PUNGS="three_concealed_pungs",_.FOUR_CONCEALED_PUNGS="four_concealed_pungs",_.FIVE_CONCEALED_PUNGS="five_concealed_pungs",_.WAITING_ONE="waiting_one",_.EDGE_WAIT="edge_wait",_.MIDDLE_WAIT="middle_wait",_.MIGI="migi",_.KONG_ON_KONG="kong_on_kong",_.ROBBING_KONG="robbing_kong",_.RED_DRAGON="red_dragon",_.GREEN_DRAGON="green_dragon",_.WHITE_DRAGON="white_dragon",_.SMALL_THREE_DRAGONS="small_three_dragons",_.BIG_THREE_DRAGONS="big_three_dragons",_.EAST_WIND="east_wind",_.SOUTH_WIND="south_wind",_.WEST_WIND="west_wind",_.NORTH_WIND="north_wind",_.SMALL_FOUR_WINDS="small_four_winds",_.BIG_FOUR_WINDS="big_four_winds",_.CORRECT_FLOWER="correct_flower",_.ALL_FLOWERS="all_flowers",_.LAST_TILE_DRAW="last_tile_draw",_.BLESSING_OF_HEAVEN="blessing_of_heaven",_.BLESSING_OF_EARTH="blessing_of_earth",_.ALL_HONORS="all_honors",_.ALL_ONE_SUIT="all_one_suit",_.LIU_LIU="liu_liu",_))(e||{});const J={[l.EAST]:"東",[l.SOUTH]:"南",[l.WEST]:"西",[l.NORTH]:"北"},q={[e.BUTT_HU]:"屁胡",[e.COMMON]:"平胡",[e.CONCEALED_HAND]:"門清",[e.ALL_PUNGS]:"碰碰胡",[e.MIXED_ONE_SUIT]:"混一色",[e.ALL_ONE_SUIT]:"清一色",[e.LIU_LIU]:"嚦咕嚦咕",[e.KONG_ON_KONG]:"槓上開花",[e.ROBBING_KONG]:"搶槓",[e.RED_DRAGON]:"紅中",[e.GREEN_DRAGON]:"青發",[e.WHITE_DRAGON]:"白板",[e.SMALL_THREE_DRAGONS]:"小三元",[e.BIG_THREE_DRAGONS]:"大三元",[e.EAST_WIND]:"東風",[e.SOUTH_WIND]:"南風",[e.WEST_WIND]:"西風",[e.NORTH_WIND]:"北風",[e.SMALL_FOUR_WINDS]:"小四喜",[e.BIG_FOUR_WINDS]:"大四喜",[e.CORRECT_FLOWER]:"正花",[e.ALL_FLOWERS]:"八仙過海",[e.LAST_TILE_DRAW]:"海底撈月",[e.BLESSING_OF_HEAVEN]:"天胡",[e.BLESSING_OF_EARTH]:"地胡",[e.ALL_HONORS]:"字一色",[e.ALL_HUMAN]:"全求人",[e.THREE_CONCEALED_PUNGS]:"三暗刻",[e.FOUR_CONCEALED_PUNGS]:"四暗刻",[e.FIVE_CONCEALED_PUNGS]:"五暗刻",[e.WAITING_ONE]:"單吊",[e.EDGE_WAIT]:"邊張",[e.MIDDLE_WAIT]:"中洞",[e.MIGI]:"migi"},z={tai0:[e.BUTT_HU],tai1:[e.CONCEALED_HAND,e.WAITING_ONE,e.EDGE_WAIT,e.MIDDLE_WAIT,e.KONG_ON_KONG,e.ROBBING_KONG,e.RED_DRAGON,e.GREEN_DRAGON,e.WHITE_DRAGON,e.EAST_WIND,e.SOUTH_WIND,e.WEST_WIND,e.NORTH_WIND,e.CORRECT_FLOWER,e.LAST_TILE_DRAW],tai2:[e.COMMON,e.ALL_PUNGS,e.ALL_HUMAN,e.THREE_CONCEALED_PUNGS],tai4:[e.MIXED_ONE_SUIT,e.FOUR_CONCEALED_PUNGS,e.SMALL_THREE_DRAGONS],tai8:[e.FIVE_CONCEALED_PUNGS,e.BIG_THREE_DRAGONS,e.SMALL_FOUR_WINDS,e.ALL_FLOWERS,e.ALL_ONE_SUIT,e.LIU_LIU,e.MIGI],tai16:[e.BIG_FOUR_WINDS,e.BLESSING_OF_EARTH,e.ALL_HONORS],tai24:[e.BLESSING_OF_HEAVEN]},V=[l.EAST,l.SOUTH,l.WEST,l.NORTH],M=[l.EAST,l.SOUTH,l.WEST,l.NORTH],A={basePoint:10,baseMultiplier:2,startingScore:0,enableContinuousDealer:!1,enableFlowerTiles:!1,enableHonorTiles:!1,enableLiuLiu:!1},Q={[e.BUTT_HU]:0,[e.COMMON]:2,[e.CONCEALED_HAND]:1,[e.ALL_PUNGS]:2,[e.MIXED_ONE_SUIT]:4,[e.ALL_HUMAN]:2,[e.THREE_CONCEALED_PUNGS]:2,[e.FOUR_CONCEALED_PUNGS]:4,[e.FIVE_CONCEALED_PUNGS]:8,[e.WAITING_ONE]:1,[e.EDGE_WAIT]:1,[e.MIDDLE_WAIT]:1,[e.MIGI]:8,[e.KONG_ON_KONG]:1,[e.ROBBING_KONG]:1,[e.RED_DRAGON]:1,[e.GREEN_DRAGON]:1,[e.WHITE_DRAGON]:1,[e.SMALL_THREE_DRAGONS]:4,[e.BIG_THREE_DRAGONS]:8,[e.EAST_WIND]:1,[e.SOUTH_WIND]:1,[e.WEST_WIND]:1,[e.NORTH_WIND]:1,[e.SMALL_FOUR_WINDS]:8,[e.BIG_FOUR_WINDS]:16,[e.CORRECT_FLOWER]:1,[e.ALL_FLOWERS]:8,[e.LAST_TILE_DRAW]:1,[e.BLESSING_OF_HEAVEN]:24,[e.BLESSING_OF_EARTH]:16,[e.ALL_HONORS]:16,[e.ALL_ONE_SUIT]:8,[e.LIU_LIU]:8},h={CURRENT_GAME:"mahjong_current_game"};function j(_,E,N,i,D,I,u,W){const U=(I+i)*D,n=[];if(E===b.SELF_DRAW){const L=Object.values(l),o=u&&W!==void 0?W*2+1:0;if(_===u){const R=(I+i)*D;L.forEach(r=>{r===_?n.push({position:r,change:R*3}):n.push({position:r,change:-R})})}else{const R=i-o,r=(I+R)*D,t=(I+i)*D;L.forEach(a=>{if(a===_){let s=0;L.forEach(c=>{c!==_&&(c===u&&u?s+=t:s+=r)}),n.push({position:a,change:s})}else a===u&&u?n.push({position:a,change:-t}):n.push({position:a,change:-r})})}}else E===b.DISCARD&&N&&Object.values(l).forEach(o=>{o===_?n.push({position:o,change:U}):o===N?n.push({position:o,change:-U}):n.push({position:o,change:0})});return n}function F(_,E){return _+E}function X(_,E){try{const N=JSON.stringify(E);localStorage.setItem(_,N)}catch(N){console.error("儲存資料失敗:",N)}}function Y(_){try{const E=localStorage.getItem(_);return E?JSON.parse(E):null}catch(E){return console.error("讀取資料失敗:",E),null}}function $(_){try{localStorage.removeItem(_)}catch(E){console.error("刪除資料失敗:",E)}}const Z=K("game",()=>{const _=x(null),E=C(()=>{var r;return((r=_.value)==null?void 0:r.isActive)??!1}),N=C(()=>{var r;return((r=_.value)==null?void 0:r.players)??[]}),i=C(()=>{var r;return((r=_.value)==null?void 0:r.rounds)??[]}),D=C(()=>{var r;return((r=_.value)==null?void 0:r.settings)??A});function I(r,t){const a=Date.now(),s=`game_${a}`,c=V.map((O,T)=>({id:`player_${T}`,name:r[T]||`玩家${T+1}`,position:O,totalScore:(t==null?void 0:t.startingScore)??A.startingScore}));_.value={gameId:s,startTime:a,players:c,rounds:[],settings:{...A,...t},currentRoundNumber:1,currentDealer:l.EAST,dealerWinCount:0,isActive:!0},o()}function u(r,t,a,s,c){if(!_.value){console.error("遊戲狀態不存在，無法新增記錄");return}const{settings:O,currentRoundNumber:T}=_.value;console.log("新增記錄：",{winnerPosition:r,winType:t,tai:a,loserPosition:s,basePoint:O.basePoint,baseMultiplier:O.baseMultiplier});const d=t==="draw",S=_.value.currentDealer;let f=[],G=!1,g=S;d?(f=[],G=!0,g=S,_.value.dealerWinCount+=1):(f=j(r,t,s,a,O.basePoint,O.baseMultiplier,S,_.value.dealerWinCount),console.log("計算的分數變動：",f),f.forEach(({position:B,change:w})=>{const v=_.value.players.find(P=>P.position===B);v&&(v.totalScore=F(v.totalScore,w))}),G=r===S,G&&(_.value.dealerWinCount+=1),g=G?S:W(S));const H={id:`round_${Date.now()}`,roundNumber:T,timestamp:Date.now(),dealerPosition:S,nextDealer:g,isDealerWin:G,dealerWinCount:_.value.dealerWinCount,winnerPosition:r,winType:t,loserPosition:s,handTypes:c,tai:a,basePoint:O.basePoint,baseMultiplier:O.baseMultiplier,scoreChanges:f};_.value.rounds.push(H),_.value.currentRoundNumber+=1,_.value.currentDealer=g,G||(_.value.dealerWinCount=0),o()}function W(r){const a=(M.indexOf(r)+1)%M.length;return M[a]}function U(r){if(!_.value)return;const t=_.value.rounds.findIndex(a=>a.id===r);t!==-1&&(_.value.rounds.splice(t),n(),o())}function n(){_.value&&(_.value.players.forEach(r=>{r.totalScore=_.value.settings.startingScore}),_.value.rounds.forEach(r=>{r.scoreChanges.forEach(({position:t,change:a})=>{const s=_.value.players.find(c=>c.position===t);s&&(s.totalScore=F(s.totalScore,a))})}))}function L(){_.value&&(_.value.isActive=!1,o())}function o(){_.value&&X(h.CURRENT_GAME,_.value)}function m(){const r=Y(h.CURRENT_GAME);r&&(!r.settings.baseMultiplier&&r.settings.baseMultiplier!==0&&(r.settings.baseMultiplier=A.baseMultiplier),r.settings.enableFlowerTiles===void 0&&(r.settings.enableFlowerTiles=A.enableFlowerTiles),r.settings.enableHonorTiles===void 0&&(r.settings.enableHonorTiles=A.enableHonorTiles),r.settings.enableLiuLiu===void 0&&(r.settings.enableLiuLiu=A.enableLiuLiu),r.currentDealer||(r.currentDealer=l.EAST),r.dealerWinCount===void 0&&(r.dealerWinCount=0),r.rounds.forEach(t=>{!t.baseMultiplier&&t.baseMultiplier!==0&&(t.baseMultiplier=r.settings.baseMultiplier)}),_.value=r)}function R(){_.value=null,$(h.CURRENT_GAME)}return{gameState:_,isGameActive:E,currentPlayers:N,currentRounds:i,currentSettings:D,startNewGame:I,addRound:u,deleteRound:U,endGame:L,loadGameState:m,clearGameState:R,recalculateAllScores:n}});export{z as C,A as D,Q as H,V as W,J as a,l as b,b as c,j as d,e,q as f,Z as u};
