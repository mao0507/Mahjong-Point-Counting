import{W as M,u as N,a as C}from"./game-C3oTRyYc.js";import{c as d,d as E,k as F,a as _,b as s,t as n,u,F as D,e as T,o as m,n as W,_ as G}from"./index-B-TiXjD_.js";import{b as $}from"./format-GyRy-UB-.js";function A(i){const c=d(()=>i?M.map(a=>{const r=i.players.find(o=>o.position===a);if(!r)return I(a,"");const l=i.rounds,f=l.filter(o=>o.winnerPosition===a).length,x=l.filter(o=>o.winnerPosition===a&&o.winType==="self_draw").length,t=l.filter(o=>o.winnerPosition===a&&o.winType==="discard").length,e=l.filter(o=>o.loserPosition===a).length,h=l.length>0?f/l.length:0,k=l.filter(o=>o.winnerPosition===a),R=k.reduce((o,P)=>{const v=P.scoreChanges.find(y=>y.position===a);return o+((v==null?void 0:v.change)||0)},0),L=f>0?R/f:0,j=k.reduce((o,P)=>{const v=P.scoreChanges.find(B=>B.position===a),y=(v==null?void 0:v.change)||0;return y>o?y:o},0);return{position:a,name:r.name,totalWins:f,selfDrawWins:x,discardWins:t,totalLoses:e,winRate:h,averageWinPoints:L,maxWinPoints:j,finalScore:r.totalScore}}):[]),p=d(()=>[...c.value].sort((a,r)=>r.finalScore-a.finalScore)),g=d(()=>p.value.length===0?null:p.value[0]),b=d(()=>(i==null?void 0:i.rounds.length)||0),w=d(()=>i?Math.max(...i.rounds.map(a=>a.tai),0):0),S=d(()=>!i||i.rounds.length===0?0:i.rounds.reduce((r,l)=>r+l.tai,0)/i.rounds.length);return{playerStatistics:c,sortedByScore:p,winner:g,totalRounds:b,maxTai:w,averageTai:S}}function I(i,c){return{position:i,name:c,totalWins:0,selfDrawWins:0,discardWins:0,totalLoses:0,winRate:0,averageWinPoints:0,maxWinPoints:0,finalScore:0}}const z={class:"statistics-page min-h-full p-4 pb-20"},O={key:0,class:"text-center text-gray-500 mt-10"},V={key:1,class:"space-y-4"},q={class:"mahjong-card"},H={class:"grid grid-cols-2 gap-4"},J={class:"stat-item"},K={class:"stat-value"},Q={class:"stat-item"},U={class:"stat-value text-base"},X={class:"stat-item"},Y={class:"stat-value text-mahjong-gold"},Z={class:"stat-item"},ss={class:"stat-value text-blue-600"},ts={class:"mahjong-card"},es={class:"space-y-3"},ns={class:"flex items-center gap-3"},os={class:"flex items-center gap-2"},as={class:"wind-badge"},is={class:"font-bold text-gray-800"},ls={class:"flex items-center gap-2 mb-3"},rs={class:"wind-badge"},ds={class:"font-bold text-gray-800"},cs={class:"grid grid-cols-2 gap-3 text-sm"},us={class:"stat-detail-item"},vs={class:"value text-green-600"},_s={class:"stat-detail-item"},ms={class:"value text-blue-600"},fs={class:"stat-detail-item"},ps={class:"value"},gs={class:"stat-detail-item"},xs={class:"value"},hs={class:"stat-detail-item"},bs={class:"value text-red-600"},ys={class:"stat-detail-item"},Ws={class:"value text-green-600"},ws={class:"stat-detail-item"},Ss={class:"value text-mahjong-gold"},Ps={class:"stat-detail-item"},ks=E({__name:"index",setup(i){const c=N();F(()=>{c.loadGameState()});const p=d(()=>c.isGameActive),g=d(()=>c.gameState),b=C,{playerStatistics:w,sortedByScore:S,totalRounds:a,maxTai:r,averageTai:l}=A(g.value),f=d(()=>{if(!g.value)return"-";const x=Date.now()-g.value.startTime,t=Math.floor(x/(1e3*60*60)),e=Math.floor(x%(1e3*60*60)/(1e3*60));return t>0?`${t}小時${e}分`:`${e}分鐘`});return(x,t)=>(m(),_("div",z,[t[15]||(t[15]=s("h1",{class:"text-2xl font-bold text-center mb-4 text-mahjong-green"}," 統計資訊 ",-1)),p.value?(m(),_("div",V,[s("div",q,[t[5]||(t[5]=s("h2",{class:"font-bold text-gray-800 mb-3"},"遊戲總覽",-1)),s("div",H,[s("div",J,[t[1]||(t[1]=s("div",{class:"stat-label"},"總局數",-1)),s("div",K,n(u(a)),1)]),s("div",Q,[t[2]||(t[2]=s("div",{class:"stat-label"},"遊戲時長",-1)),s("div",U,n(f.value),1)]),s("div",X,[t[3]||(t[3]=s("div",{class:"stat-label"},"最大台數",-1)),s("div",Y,n(u(r)),1)]),s("div",Z,[t[4]||(t[4]=s("div",{class:"stat-label"},"平均台數",-1)),s("div",ss,n(u(l).toFixed(1)),1)])])]),s("div",ts,[t[6]||(t[6]=s("h2",{class:"font-bold text-gray-800 mb-3"},"分數排名",-1)),s("div",es,[(m(!0),_(D,null,T(u(S),(e,h)=>(m(),_("div",{key:e.position,class:W(["ranking-item",{winner:h===0}])},[s("div",ns,[s("div",{class:W(["rank-badge",`rank-${h+1}`])},n(h+1),3),s("div",os,[s("span",as,n(u(b)[e.position]),1),s("span",is,n(e.name),1)])]),s("div",{class:W(["text-xl font-bold",{"text-green-600":e.finalScore>0,"text-red-600":e.finalScore<0,"text-gray-600":e.finalScore===0}])},n(e.finalScore>0?"+":"")+n(e.finalScore.toLocaleString()),3)],2))),128))])]),(m(!0),_(D,null,T(u(w),e=>(m(),_("div",{key:e.position,class:"mahjong-card"},[s("div",ls,[s("span",rs,n(u(b)[e.position]),1),s("h3",ds,n(e.name),1)]),s("div",cs,[s("div",us,[t[7]||(t[7]=s("span",{class:"label"},"總胡牌次數",-1)),s("span",vs,n(e.totalWins),1)]),s("div",_s,[t[8]||(t[8]=s("span",{class:"label"},"胡牌率",-1)),s("span",ms,n(u($)(e.winRate)),1)]),s("div",fs,[t[9]||(t[9]=s("span",{class:"label"},"自摸次數",-1)),s("span",ps,n(e.selfDrawWins),1)]),s("div",gs,[t[10]||(t[10]=s("span",{class:"label"},"放炮贏次數",-1)),s("span",xs,n(e.discardWins),1)]),s("div",hs,[t[11]||(t[11]=s("span",{class:"label"},"放炮次數",-1)),s("span",bs,n(e.totalLoses),1)]),s("div",ys,[t[12]||(t[12]=s("span",{class:"label"},"平均贏分",-1)),s("span",Ws,n(e.averageWinPoints>0?e.averageWinPoints.toFixed(0):"-"),1)]),s("div",ws,[t[13]||(t[13]=s("span",{class:"label"},"最高單局得分",-1)),s("span",Ss,n(e.maxWinPoints>0?"+"+e.maxWinPoints.toLocaleString():"-"),1)]),s("div",Ps,[t[14]||(t[14]=s("span",{class:"label"},"最終分數",-1)),s("span",{class:W(["value font-bold",{"text-green-600":e.finalScore>0,"text-red-600":e.finalScore<0}])},n(e.finalScore>0?"+":"")+n(e.finalScore.toLocaleString()),3)])])]))),128))])):(m(),_("div",O,[...t[0]||(t[0]=[s("p",{class:"text-4xl mb-3"},"📊",-1),s("p",null,"目前沒有進行中的遊戲",-1),s("p",{class:"text-sm mt-2"},"請先開始新遊戲",-1)])]))]))}}),Ls=G(ks,[["__scopeId","data-v-cc94d01e"]]);export{Ls as default};
