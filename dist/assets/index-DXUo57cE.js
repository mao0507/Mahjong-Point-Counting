import{D as ye,W as he,a as Y,b as ke,H as se,c as m,d as we,C as Se,e as D,f as ae,u as Te}from"./game-Dw5vbGhC.js";import{d as z,r as E,c as f,a as s,b as e,F as w,e as j,u,w as O,v as ne,f as le,g as Q,o as t,t as a,_ as Z,h as p,n as R,i as I,j as $e,k as De,l as Ce,m as X}from"./index-DHn3yG1W.js";import{C as Re}from"./ConfirmDialog-JK8S4K0x.js";const Pe={class:"player-setup mahjong-card"},je={class:"space-y-3 mb-6"},Ae={class:"flex-shrink-0 w-12 h-12 bg-mahjong-green text-white rounded-lg flex items-center justify-center font-bold text-lg"},We=["onUpdate:modelValue","placeholder"],Le={class:"space-y-3 mb-6"},Ne={class:"flex items-center justify-between"},Ee={class:"flex items-center justify-between"},Fe={class:"flex items-center justify-between"},Me={class:"border-t border-gray-200 pt-3 space-y-3"},Ie={class:"flex items-center justify-between"},He={class:"relative inline-flex items-center cursor-pointer"},Oe={class:"flex items-center justify-between"},Ge={class:"relative inline-flex items-center cursor-pointer"},Ue={class:"flex items-center justify-between"},Ve={class:"relative inline-flex items-center cursor-pointer"},Be=["disabled"],Ye=z({__name:"PlayerSetup",props:{defaultPlayerNames:{default:()=>["","","",""]},defaultSettings:{}},emits:["start"],setup(v,{emit:S}){const b=v,A=S,W=Y,d=he,T=E(b.defaultPlayerNames||["","","",""]),y=E({...ye,...b.defaultSettings}),L=f(()=>T.value.some(N=>N.trim()!==""));function U(){if(!L.value)return;const N=T.value.map((o,c)=>o.trim()||`玩家${c+1}`);A("start",N,y.value)}return(N,o)=>(t(),s("div",Pe,[o[18]||(o[18]=e("h2",{class:"text-xl font-bold text-center mb-4 text-mahjong-green"}," 設定玩家 ",-1)),e("div",je,[(t(!0),s(w,null,j(u(d),(c,r)=>(t(),s("div",{key:c,class:"flex items-center gap-3"},[e("div",Ae,a(u(W)[c]),1),O(e("input",{"onUpdate:modelValue":P=>T.value[r]=P,type:"text",placeholder:`玩家 ${r+1}`,class:"mahjong-input flex-1",maxlength:"10"},null,8,We),[[le,T.value[r]]])]))),128))]),e("div",Le,[o[17]||(o[17]=e("h3",{class:"font-bold text-gray-700"},"遊戲設定",-1)),e("div",Ne,[o[7]||(o[7]=e("label",{class:"text-gray-700"},"底分（元）",-1)),O(e("select",{"onUpdate:modelValue":o[0]||(o[0]=c=>y.value.basePoint=c),class:"select-field"},[...o[6]||(o[6]=[e("option",{value:1},"1 元",-1),e("option",{value:5},"5 元",-1),e("option",{value:10},"10 元",-1),e("option",{value:20},"20 元",-1),e("option",{value:50},"50 元",-1),e("option",{value:100},"100 元",-1)])],512),[[ne,y.value.basePoint,void 0,{number:!0}]])]),e("div",Ee,[o[9]||(o[9]=e("label",{class:"text-gray-700"},"底（台）",-1)),O(e("select",{"onUpdate:modelValue":o[1]||(o[1]=c=>y.value.baseMultiplier=c),class:"select-field"},[...o[8]||(o[8]=[e("option",{value:0},"0 底",-1),e("option",{value:1},"1 底",-1),e("option",{value:2},"2 底",-1),e("option",{value:3},"3 底",-1),e("option",{value:4},"4 底",-1)])],512),[[ne,y.value.baseMultiplier,void 0,{number:!0}]])]),e("div",Fe,[o[10]||(o[10]=e("label",{class:"text-gray-700"},"起始分數",-1)),O(e("input",{"onUpdate:modelValue":o[2]||(o[2]=c=>y.value.startingScore=c),type:"number",class:"w-32 px-4 py-2 border border-gray-300 rounded-lg text-right"},null,512),[[le,y.value.startingScore,void 0,{number:!0}]])]),e("div",Me,[e("div",Ie,[o[12]||(o[12]=e("div",null,[e("label",{class:"text-gray-700 font-medium"},"見花"),e("p",{class:"text-xs text-gray-500"},"每張花牌加 1 台")],-1)),e("label",He,[O(e("input",{"onUpdate:modelValue":o[3]||(o[3]=c=>y.value.enableFlowerTiles=c),type:"checkbox",class:"sr-only peer"},null,512),[[Q,y.value.enableFlowerTiles]]),o[11]||(o[11]=e("div",{class:"w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-mahjong-green rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-mahjong-green"},null,-1))])]),e("div",Oe,[o[14]||(o[14]=e("div",null,[e("label",{class:"text-gray-700 font-medium"},"見字"),e("p",{class:"text-xs text-gray-500"},"風牌、三元牌加台")],-1)),e("label",Ge,[O(e("input",{"onUpdate:modelValue":o[4]||(o[4]=c=>y.value.enableHonorTiles=c),type:"checkbox",class:"sr-only peer"},null,512),[[Q,y.value.enableHonorTiles]]),o[13]||(o[13]=e("div",{class:"w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-mahjong-green rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-mahjong-green"},null,-1))])]),e("div",Ue,[o[16]||(o[16]=e("div",null,[e("label",{class:"text-gray-700 font-medium"},"嚦咕嚦咕")],-1)),e("label",Ve,[O(e("input",{"onUpdate:modelValue":o[5]||(o[5]=c=>y.value.enableLiuLiu=c),type:"checkbox",class:"sr-only peer"},null,512),[[Q,y.value.enableLiuLiu]]),o[15]||(o[15]=e("div",{class:"w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-mahjong-green rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-mahjong-green"},null,-1))])])])]),e("button",{onClick:U,disabled:!L.value,class:"w-full mahjong-button disabled:opacity-50 disabled:cursor-not-allowed"}," 開始遊戲 ",8,Be)]))}}),ze=Z(Ye,[["__scopeId","data-v-bdebb731"]]),qe={class:"score-board"},Je={class:"grid grid-cols-2 gap-3 mb-4"},Ke={class:"flex items-center justify-between mb-2"},Qe={class:"flex items-center gap-2"},Xe={class:"w-8 h-8 bg-mahjong-green text-white rounded flex items-center justify-center text-sm font-bold"},Ze={class:"font-bold text-gray-800 truncate"},et={key:0,class:"text-xs bg-red-500 text-white px-2 py-0.5 rounded font-bold"},tt={key:0},st={class:"text-right"},nt={class:"stats-info text-center text-sm text-gray-600"},lt={key:0},at={key:1,class:"mt-2"},ot={class:"inline-flex items-center gap-1 bg-orange-100 text-orange-700 px-3 py-1 rounded-full font-bold text-xs"},it={key:0,class:"text-red-600"},rt={key:1},ut=z({__name:"ScoreBoard",props:{players:{},currentRound:{},totalRounds:{default:0},highlightedPosition:{},currentDealer:{},dealerWinCount:{}},setup(v){const S=Y;function b(A){return A>0?`+${A.toLocaleString()}`:A.toLocaleString()}return(A,W)=>(t(),s("div",qe,[W[1]||(W[1]=e("h2",{class:"text-xl font-bold text-center mb-4 text-mahjong-green"}," 計分板 ",-1)),e("div",Je,[(t(!0),s(w,null,j(v.players,d=>(t(),s("div",{key:d.id,class:R(["score-card mahjong-card",{highlight:v.highlightedPosition===d.position,"dealer-card":v.currentDealer===d.position}])},[e("div",Ke,[e("div",Qe,[e("div",Xe,a(u(S)[d.position]),1),e("span",Ze,a(d.name),1),v.currentDealer===d.position?(t(),s("span",et,[W[0]||(W[0]=I(" 莊",-1)),v.dealerWinCount&&v.dealerWinCount>0?(t(),s("span",tt,a(v.dealerWinCount),1)):p("",!0)])):p("",!0)])]),e("div",st,[e("div",{class:R(["text-2xl font-bold",{"text-green-600":d.totalScore>0,"text-red-600":d.totalScore<0,"text-gray-600":d.totalScore===0}])},a(b(d.totalScore)),3)])],2))),128))]),e("div",nt,[e("p",null,"第 "+a(v.currentRound)+" 局",1),v.totalRounds>0?(t(),s("p",lt,"總共 "+a(v.totalRounds)+" 局",1)):p("",!0),v.currentDealer&&v.dealerWinCount!==void 0?(t(),s("p",at,[e("span",ot,[e("span",null,"莊家："+a(u(S)[v.currentDealer]),1),v.dealerWinCount>0?(t(),s("span",it,a(v.dealerWinCount)+"連勝",1)):(t(),s("span",rt,"新莊"))])])):p("",!0)])]))}}),dt=Z(ut,[["__scopeId","data-v-747a9542"]]),ct={class:"score-input mahjong-card"},vt={class:"mb-6"},ft={class:"grid grid-cols-4 gap-2"},bt=["onClick"],gt={class:"text-lg font-bold"},pt={key:0,class:"text-red-600"},xt={class:"text-xs truncate"},mt={key:0,class:"mb-6"},_t={class:"grid grid-cols-2 gap-3"},yt={key:0,class:"mt-4 bg-orange-50 p-3 rounded-lg"},ht={class:"flex items-center justify-between"},kt={class:"text-gray-700 font-medium"},wt={class:"text-orange-600 font-bold"},St={class:"mt-1 text-xs text-gray-600 text-center"},Tt={key:1,class:"mb-6"},$t={class:"grid grid-cols-3 gap-2"},Dt=["onClick"],Ct={class:"text-lg font-bold"},Rt={key:0,class:"text-red-600"},Pt={class:"text-xs truncate"},jt={key:2,class:"mb-6"},At={class:"font-bold text-gray-700 mb-3"},Wt={key:0,class:"mb-3"},Lt={class:"grid grid-cols-3 gap-2"},Nt=["onClick"],Et={class:"mb-3"},Ft={class:"grid grid-cols-3 gap-2"},Mt=["onClick"],It={class:"mb-3"},Ht={class:"grid grid-cols-3 gap-2"},Ot=["onClick"],Gt={class:"mb-3"},Ut={class:"grid grid-cols-3 gap-2"},Vt=["onClick"],Bt={class:"mb-3"},Yt={class:"grid grid-cols-3 gap-2"},zt=["onClick"],qt={class:"mb-3"},Jt={class:"grid grid-cols-3 gap-2"},Kt=["onClick"],Qt={class:"mb-3"},Xt={class:"grid grid-cols-3 gap-2"},Zt=["onClick"],es={class:"flex justify-center"},ts={key:3,class:"mb-6"},ss={class:"font-bold text-gray-700 mb-3"},ns={class:"bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg"},ls={class:"space-y-2 text-sm"},as={key:0,class:"flex justify-between items-center"},os={key:1,class:"space-y-1"},is={class:"text-gray-700"},rs={class:"font-bold text-purple-600"},us={key:0,class:"flex justify-between items-center pt-1 border-t border-gray-200"},ds={class:"font-bold text-purple-600"},cs={key:2,class:"flex justify-between items-center"},vs={class:"text-gray-700"},fs={class:"font-bold text-orange-600"},bs={class:"pt-2 border-t-2 border-gray-300 space-y-1"},gs={key:0,class:"flex justify-between items-center"},ps={class:"font-bold text-mahjong-green text-xl"},xs={key:1,class:"space-y-1"},ms={class:"flex justify-between items-center"},_s={class:"font-bold text-mahjong-green"},ys={class:"flex justify-between items-center"},hs={class:"font-bold text-mahjong-green"},ks={key:2,class:"flex justify-between items-center"},ws={class:"text-gray-700 text-xs"},Ss={key:0},Ts={class:"font-bold text-blue-600 text-lg"},$s={key:3,class:"flex justify-between items-center"},Ds={class:"text-gray-700 text-xs"},Cs={class:"font-bold text-blue-600 text-lg"},Rs={key:4,class:"text-xs text-gray-500 text-center pt-1 space-y-1"},Ps={key:0},js={key:1},As={key:5,class:"text-xs text-gray-500 text-center pt-1"},Ws={key:4,class:"mb-6 p-4 bg-gray-50 rounded-lg"},Ls={class:"space-y-1"},Ns={class:"text-sm"},Es={class:"mt-2 text-xs text-gray-500 text-center"},Fs={class:"space-y-3"},Ms={class:"flex gap-3"},Is=["disabled"],Hs=z({__name:"ScoreInput",props:{players:{},basePoint:{},baseMultiplier:{},enableFlowerTiles:{type:Boolean,default:!1},enableHonorTiles:{type:Boolean,default:!1},currentDealer:{},dealerWinCount:{default:0}},emits:["submit"],setup(v,{emit:S}){const b=v,A=S,W=Y,d=ae,T=Se,y=f(()=>b.enableFlowerTiles),L=f(()=>b.enableHonorTiles),U=f(()=>b.currentDealer||ke.EAST),N=f(()=>b.dealerWinCount||0),o=E(),c=E(),r=E(),P=E(),x=E([]);$e(U,i=>{o.value=i},{immediate:!0});const q=f(()=>b.players.filter(i=>i.position!==c.value)),C=f(()=>c.value===o.value),g=f(()=>P.value===o.value),h=f(()=>!x.value||x.value.length===0?0:x.value.reduce((i,l)=>i+(se[l]||0),0)),$=f(()=>N.value*2+1),k=f(()=>{let i=0;return r.value===m.SELF_DRAW&&(i=1),i+=h.value,(C.value||g.value||r.value===m.SELF_DRAW&&!C.value)&&(i+=$.value),r.value===m.SELF_DRAW&&(i=Math.max(1,i)),i}),F=f(()=>(b.baseMultiplier+k.value)*b.basePoint),V=f(()=>r.value===m.SELF_DRAW?F.value*3:F.value),B=f(()=>F.value),_=f(()=>r.value!==m.SELF_DRAW||C.value?F.value:(b.baseMultiplier+k.value)*b.basePoint),G=f(()=>{if(r.value!==m.SELF_DRAW||C.value)return F.value;const i=k.value-$.value;return(b.baseMultiplier+i)*b.basePoint}),oe=f(()=>r.value!==m.SELF_DRAW||C.value?k.value:k.value-$.value),J=f(()=>!(!c.value||!r.value||r.value===m.DISCARD&&!P.value)),ee=f(()=>J.value&&k.value>0),ie=f(()=>J.value?we(c.value,r.value,P.value,k.value,b.basePoint,b.baseMultiplier,o.value,N.value):[]);function re(i){c.value=i,P.value===i&&(P.value=void 0)}function te(i){r.value=i,i===m.SELF_DRAW&&(P.value=void 0)}function ue(i){P.value=i}function H(i){const l=x.value.indexOf(i);l>-1?x.value.splice(l,1):x.value.push(i)}function de(){x.value=[]}function ce(i){const l=b.players.find(n=>n.position===i);return l?l.name:""}function K(){c.value=void 0,r.value=void 0,P.value=void 0,x.value=[]}function ve(){ee.value&&(A("submit",{dealerPosition:o.value,winnerPosition:c.value,winType:r.value,tai:k.value,loserPosition:P.value,handTypes:x.value}),K())}function fe(){o.value&&(A("submit",{dealerPosition:o.value,winnerPosition:o.value,winType:m.DRAW,tai:0,loserPosition:void 0,handTypes:void 0}),K())}function be(){return T.tai1.filter(l=>[D.RED_DRAGON,D.GREEN_DRAGON,D.WHITE_DRAGON,D.EAST_WIND,D.SOUTH_WIND,D.WEST_WIND,D.NORTH_WIND].includes(l)?L.value:l===D.CORRECT_FLOWER?y.value:!0)}function ge(){return T.tai2.filter(l=>!(r.value===m.SELF_DRAW&&[D.ALL_HUMAN,D.COMMON].includes(l)))}function pe(){return T.tai4.filter(l=>l===D.SMALL_THREE_DRAGONS?L.value:!0)}function xe(){return T.tai8.filter(l=>[D.BIG_THREE_DRAGONS,D.SMALL_FOUR_WINDS].includes(l)?L.value:l===D.ALL_FLOWERS?y.value:!0)}function me(){return T.tai16.filter(l=>[D.BIG_FOUR_WINDS,D.ALL_HONORS].includes(l)?L.value:!0)}function _e(){return T.tai24}return(i,l)=>(t(),s("div",ct,[l[20]||(l[20]=e("h2",{class:"text-xl font-bold text-center mb-4 text-mahjong-green"}," 記錄本局 ",-1)),e("div",vt,[l[2]||(l[2]=e("h3",{class:"font-bold text-gray-700 mb-3"},"1. 誰胡牌？",-1)),e("div",ft,[(t(!0),s(w,null,j(v.players,n=>(t(),s("button",{key:n.id,onClick:M=>re(n.position),class:R(["player-button",{active:c.value===n.position,"dealer-button":o.value===n.position}])},[e("div",gt,[I(a(u(W)[n.position])+" ",1),n.position===o.value?(t(),s("span",pt,"莊")):p("",!0)]),e("div",xt,a(n.name),1)],10,bt))),128))])]),c.value?(t(),s("div",mt,[l[5]||(l[5]=e("h3",{class:"font-bold text-gray-700 mb-3"},"2. 胡牌方式",-1)),e("div",_t,[e("button",{onClick:l[0]||(l[0]=n=>te(u(m).SELF_DRAW)),class:R(["win-type-button",{active:r.value===u(m).SELF_DRAW}])},[...l[3]||(l[3]=[e("span",{class:"text-2xl mb-1"},"🎯",-1),e("span",{class:"font-bold"},"自摸",-1)])],2),e("button",{onClick:l[1]||(l[1]=n=>te(u(m).DISCARD)),class:R(["win-type-button",{active:r.value===u(m).DISCARD}])},[...l[4]||(l[4]=[e("span",{class:"text-2xl mb-1"},"💥",-1),e("span",{class:"font-bold"},"放槍",-1)])],2)]),r.value&&(C.value||g.value)?(t(),s("div",yt,[e("div",ht,[e("span",kt,a(C.value?"莊家台數":"胡莊家台數"),1),e("span",wt," +"+a($.value)+" 台 ",1)]),e("div",St,a(C.value?"連莊":"破莊")+a(N.value)+"次：2×"+a(N.value)+" + 1 = "+a($.value)+"台 ",1)])):p("",!0)])):p("",!0),r.value===u(m).DISCARD?(t(),s("div",Tt,[l[6]||(l[6]=e("h3",{class:"font-bold text-gray-700 mb-3"},"3. 誰放槍？",-1)),e("div",$t,[(t(!0),s(w,null,j(q.value,n=>(t(),s("button",{key:n.id,onClick:M=>ue(n.position),class:R(["player-button",{active:P.value===n.position,"dealer-button":o.value===n.position}])},[e("div",Ct,[I(a(u(W)[n.position])+" ",1),n.position===o.value?(t(),s("span",Rt,"莊")):p("",!0)]),e("div",Pt,a(n.name),1)],10,Dt))),128))])])):p("",!0),r.value?(t(),s("div",jt,[e("h3",At,a(r.value===u(m).DISCARD?"4":"3")+". 牌型（可選） ",1),u(T).tai0.length>0?(t(),s("div",Wt,[l[7]||(l[7]=e("div",{class:"text-xs text-gray-500 mb-2"},"0台",-1)),e("div",Lt,[(t(!0),s(w,null,j(u(T).tai0,n=>(t(),s("button",{key:n,onClick:M=>H(n),class:R(["hand-type-button",{active:x.value.includes(n)}])},a(u(d)[n]),11,Nt))),128))])])):p("",!0),e("div",Et,[l[8]||(l[8]=e("div",{class:"text-xs text-gray-500 mb-2"},"1台",-1)),e("div",Ft,[(t(!0),s(w,null,j(be(),n=>(t(),s("button",{key:n,onClick:M=>H(n),class:R(["hand-type-button",{active:x.value.includes(n)}])},a(u(d)[n]),11,Mt))),128))])]),e("div",It,[l[9]||(l[9]=e("div",{class:"text-xs text-gray-500 mb-2"},"2台",-1)),e("div",Ht,[(t(!0),s(w,null,j(ge(),n=>(t(),s("button",{key:n,onClick:M=>H(n),class:R(["hand-type-button",{active:x.value.includes(n)}])},a(u(d)[n]),11,Ot))),128))])]),e("div",Gt,[l[10]||(l[10]=e("div",{class:"text-xs text-gray-500 mb-2"},"4台",-1)),e("div",Ut,[(t(!0),s(w,null,j(pe(),n=>(t(),s("button",{key:n,onClick:M=>H(n),class:R(["hand-type-button",{active:x.value.includes(n)}])},a(u(d)[n]),11,Vt))),128))])]),e("div",Bt,[l[11]||(l[11]=e("div",{class:"text-xs text-gray-500 mb-2"},"8台",-1)),e("div",Yt,[(t(!0),s(w,null,j(xe(),n=>(t(),s("button",{key:n,onClick:M=>H(n),class:R(["hand-type-button",{active:x.value.includes(n)}])},a(u(d)[n]),11,zt))),128))])]),e("div",qt,[l[12]||(l[12]=e("div",{class:"text-xs text-gray-500 mb-2"},"16台",-1)),e("div",Jt,[(t(!0),s(w,null,j(me(),n=>(t(),s("button",{key:n,onClick:M=>H(n),class:R(["hand-type-button",{active:x.value.includes(n)}])},a(u(d)[n]),11,Kt))),128))])]),e("div",Qt,[l[13]||(l[13]=e("div",{class:"text-xs text-gray-500 mb-2"},"24台",-1)),e("div",Xt,[(t(!0),s(w,null,j(_e(),n=>(t(),s("button",{key:n,onClick:M=>H(n),class:R(["hand-type-button",{active:x.value.includes(n)}])},a(u(d)[n]),11,Zt))),128))])]),e("div",es,[e("button",{onClick:de,class:R(["hand-type-button-clear",{active:x.value.length===0}])}," 不記錄牌型 ",2)])])):p("",!0),r.value?(t(),s("div",ts,[e("h3",ss,a(r.value===u(m).DISCARD?"5":"4")+". 台數與點數計算 ",1),e("div",ns,[e("div",ls,[r.value===u(m).SELF_DRAW?(t(),s("div",as,[...l[14]||(l[14]=[e("span",{class:"text-gray-700"},"自摸保底",-1),e("span",{class:"font-bold text-green-600"},"+1 台",-1)])])):p("",!0),x.value.length>0&&h.value>0?(t(),s("div",os,[(t(!0),s(w,null,j(x.value,n=>(t(),s("div",{key:n,class:"flex justify-between items-center"},[e("span",is,a(u(d)[n]),1),e("span",rs,"+"+a(u(se)[n])+" 台",1)]))),128)),x.value.length>1?(t(),s("div",us,[l[15]||(l[15]=e("span",{class:"text-gray-700 font-medium"},"牌型總計",-1)),e("span",ds,"+"+a(h.value)+" 台",1)])):p("",!0)])):p("",!0),$.value>0?(t(),s("div",cs,[e("span",vs,[C.value?(t(),s(w,{key:0},[I("莊家自摸")],64)):g.value?(t(),s(w,{key:1},[I("胡莊家")],64)):r.value===u(m).SELF_DRAW&&!C.value?(t(),s(w,{key:2},[I("莊家台（莊家額外支付）")],64)):p("",!0),I(" （"+a(N.value)+"連勝） ",1)]),e("span",fs,"+"+a($.value)+" 台",1)])):p("",!0),e("div",bs,[C.value?(t(),s("div",gs,[l[16]||(l[16]=e("span",{class:"text-gray-800 font-bold text-base"},"總台數",-1)),e("span",ps,a(k.value)+" 台",1)])):(t(),s("div",xs,[e("div",ms,[l[17]||(l[17]=e("span",{class:"text-gray-700 text-sm"},"莊家台數",-1)),e("span",_s,a(k.value)+" 台",1)]),e("div",ys,[l[18]||(l[18]=e("span",{class:"text-gray-700 text-sm"},"閒家台數",-1)),e("span",hs,a(oe.value)+" 台",1)])])),C.value?(t(),s("div",ks,[e("span",ws,[I(" ("+a(v.baseMultiplier)+"底 + "+a(k.value)+"台) × "+a(v.basePoint)+"元 ",1),r.value===u(m).SELF_DRAW?(t(),s("span",Ss," × 3")):p("",!0)]),e("span",Ts,a(V.value.toLocaleString())+" 元 ",1)])):(t(),s("div",$s,[e("span",Ds," 莊家"+a(_.value.toLocaleString())+"元 + 閒家"+a(G.value.toLocaleString())+"元 × 2 ",1),e("span",Cs,a((_.value+G.value*2).toLocaleString())+" 元 ",1)])),r.value===u(m).SELF_DRAW?(t(),s("div",Rs,[C.value?(t(),s("div",Ps," 三家總計（各付 "+a(B.value.toLocaleString())+" 元） ",1)):(t(),s("div",js,[e("div",null,"莊家付 "+a(_.value.toLocaleString())+" 元",1),e("div",null,"閒家各付 "+a(G.value.toLocaleString())+" 元",1)]))])):(t(),s("div",As," 被胡者支付 "))])])])])):p("",!0),J.value?(t(),s("div",Ws,[l[19]||(l[19]=e("h3",{class:"font-bold text-gray-700 mb-2"},"分數變動預覽",-1)),e("div",Ls,[(t(!0),s(w,null,j(ie.value,n=>(t(),s("div",{key:n.position,class:"flex justify-between items-center"},[e("span",Ns,a(u(W)[n.position])+" "+a(ce(n.position)),1),e("span",{class:R(["font-bold",{"text-green-600":n.change>0,"text-red-600":n.change<0}])},a(n.change>0?"+":"")+a(n.change.toLocaleString()),3)]))),128))]),e("div",Es," ("+a(v.baseMultiplier)+"底 + "+a(k.value)+"台) × "+a(v.basePoint)+"元 = "+a((v.baseMultiplier+k.value)*v.basePoint)+" 元 ",1)])):p("",!0),e("div",Fs,[e("button",{onClick:fe,class:"w-full bg-gray-500 text-white font-bold py-3 px-6 rounded-lg active:scale-95 transition-transform"}," 🔄 流局（莊家連勝+1） "),e("div",Ms,[e("button",{onClick:K,class:"flex-1 mahjong-button-secondary"}," 重置 "),e("button",{onClick:ve,disabled:!ee.value,class:"flex-1 mahjong-button disabled:opacity-50 disabled:cursor-not-allowed"}," 確認記錄 ",8,Is)])])]))}}),Os=Z(Hs,[["__scopeId","data-v-5e26f206"]]),Gs={class:"game-page min-h-full p-4 pb-20"},Us={key:0,class:"max-w-lg mx-auto"},Vs={key:1,class:"space-y-4"},Bs={class:"flex items-center justify-between mb-4"},Ys={class:"flex gap-2"},zs={key:0,class:"mahjong-card"},qs={class:"space-y-2"},Js={class:"flex items-center gap-2 flex-wrap"},Ks={class:"text-gray-500"},Qs={key:0,class:"text-gray-600"},Xs={key:0,class:"font-bold text-mahjong-green"},Zs={class:"text-gray-600"},en={class:"font-bold text-mahjong-gold"},tn={key:1,class:"text-xs text-purple-600"},sn={class:"font-bold text-blue-600"},nn=["onClick"],rn=z({__name:"index",setup(v){const S=Te(),b=E(!1),A=E(["","","",""]),W=f(()=>S.isGameActive),d=f(()=>S.gameState),T=f(()=>S.currentPlayers),y=f(()=>S.currentRounds),L=f(()=>S.currentSettings),U=Y,N=ae,o=f(()=>[...y.value].reverse().slice(0,5));function c(g){var $;if(!g)return"";const h=($=d.value)==null?void 0:$.players.find(k=>k.position===g);return h?h.name:""}function r(g,h){const $=(g.baseMultiplier+g.tai)*g.basePoint;return h==="self_draw"?$*3:$}De(()=>{S.loadGameState(),d.value&&W.value&&(A.value=d.value.players.map(g=>g.name))});function P(g,h){S.startNewGame(g,h),A.value=g}function x(g){S.addRound(g.winnerPosition,g.winType,g.tai,g.loserPosition,g.handTypes)}function q(g){confirm("確定要刪除這筆記錄嗎？刪除後該局之後的記錄也會被移除。")&&S.deleteRound(g)}function C(){S.endGame(),b.value=!1}return(g,h)=>{var $,k,F,V,B;return t(),s("div",Gs,[W.value?(t(),s("div",Vs,[e("div",Bs,[h[2]||(h[2]=e("h1",{class:"text-2xl font-bold text-mahjong-green"},"麻將計分",-1)),e("div",Ys,[e("button",{onClick:h[0]||(h[0]=_=>b.value=!0),class:"px-4 py-2 bg-red-500 text-white rounded-lg text-sm font-bold active:scale-95 transition-transform"}," 結束遊戲 ")])]),X(dt,{players:T.value,"current-round":(($=d.value)==null?void 0:$.currentRoundNumber)||1,"total-rounds":y.value.length,"current-dealer":(k=d.value)==null?void 0:k.currentDealer,"dealer-win-count":(F=d.value)==null?void 0:F.dealerWinCount},null,8,["players","current-round","total-rounds","current-dealer","dealer-win-count"]),X(Os,{players:T.value,"base-point":L.value.basePoint,"base-multiplier":L.value.baseMultiplier,"enable-flower-tiles":L.value.enableFlowerTiles,"enable-honor-tiles":L.value.enableHonorTiles,"current-dealer":(V=d.value)==null?void 0:V.currentDealer,"dealer-win-count":(B=d.value)==null?void 0:B.dealerWinCount,onSubmit:x},null,8,["players","base-point","base-multiplier","enable-flower-tiles","enable-honor-tiles","current-dealer","dealer-win-count"]),o.value.length>0?(t(),s("div",zs,[h[3]||(h[3]=e("h3",{class:"font-bold text-gray-700 mb-3"},"最近記錄",-1)),e("div",qs,[(t(!0),s(w,null,j(o.value,_=>(t(),s("div",{key:_.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg text-sm"},[e("div",Js,[e("span",Ks,"第"+a(_.roundNumber)+"局",1),_.winType==="draw"?(t(),s("span",Qs," 流局 ")):(t(),s(w,{key:1},[_.winType==="self_draw"?(t(),s("span",Xs,a(u(U)[_.winnerPosition]),1)):p("",!0),e("span",Zs,a(_.winType==="self_draw"?"自摸":`${c(_.winnerPosition)} 胡 ${c(_.loserPosition)}`),1),e("span",en,a(_.tai)+"台",1),_.handTypes&&_.handTypes.length>0?(t(),s("span",tn," ("+a(_.handTypes.map(G=>u(N)[G]).join("+"))+") ",1)):p("",!0),e("span",sn,a(r(_,_.winType))+"元 ",1)],64))]),e("button",{onClick:G=>q(_.id),class:"text-red-500 text-xs px-2 py-1 hover:bg-red-50 rounded"}," 刪除 ",8,nn)]))),128))])])):p("",!0)])):(t(),s("div",Us,[X(ze,{"default-player-names":A.value,onStart:P},null,8,["default-player-names"])])),b.value?(t(),Ce(Re,{key:2,title:"確認結束遊戲？",message:"結束後將無法繼續記錄，但歷史記錄會保留。","confirm-text":"確認結束","cancel-text":"取消",onConfirm:C,onCancel:h[1]||(h[1]=_=>b.value=!1)})):p("",!0)])}}});export{rn as default};
